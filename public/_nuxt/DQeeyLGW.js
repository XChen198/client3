import{E as se,_ as $}from"./Bf1psxly.js";import{E as le}from"./CAYgcm9m.js";import{E as oe,a as ne}from"./CiuUK5St.js";import{a as re,E as ie}from"./z0lRkXp0.js";import{E as ce}from"./DjFJZaCT.js";import{E as de}from"./DG4vFwbg.js";import{E as ue}from"./CYz9hpGZ.js";import{_ as pe}from"./D4R3U5Ns.js";import"./BO-BUzP0.js";import{h as me}from"./B3en76v2.js";import"./RrxjGB37.js";import{E as V}from"./Dtsb2UZl.js";import{f as _e,a8 as fe,g as ve,r as p,h as ge,c as _,a as r,b as t,w as s,t as c,N as M,O as P,o as u,d as i,i as D,k as T,a2 as ye,p as he,e as we}from"./CsIamsOv.js";import{u as xe}from"./BTDj4EH4.js";import{g as G}from"./mO1Piuff.js";import{a as I,p as Ee,b as J,r as ke,c as Ce}from"./BQbn65E-.js";import{_ as Ve}from"./DlAUqK2U.js";import"./r5W6hzzQ.js";import"./D-9BgIql.js";const w=z=>(he("data-v-ea97d8f4"),z=z(),we(),z),De={class:"back"},ze={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024","data-v-ea893728":"",style:{width:"24px","vertical-align":"text-top"}},je=w(()=>r("path",{fill:"currentColor",d:"M224 480h640a32 32 0 1 1 0 64H224a32 32 0 0 1 0-64"},null,-1)),Ue=w(()=>r("path",{fill:"currentColor",d:"m237.248 512 265.408 265.344a32 32 0 0 1-45.312 45.312l-288-288a32 32 0 0 1 0-45.312l288-288a32 32 0 1 1 45.312 45.312z"},null,-1)),be=[je,Ue],Ae=w(()=>r("span",{style:{"margin-left":"5px"}},"返回",-1)),Me={class:"post"},Te=w(()=>r("img",{src:$},null,-1)),Ie={class:"username"},$e={class:"main"},Se=["innerHTML"],Be={class:"footer"},Pe={class:"comments"},Re=w(()=>r("img",{src:$},null,-1)),Ne={style:{"margin-left":"8px"}},He={class:"content"},Le={style:{margin:"0 auto"},class:"timeAndReply"},Fe={key:0},Oe={class:"sendComment",style:{"text-align":"center"}},We=w(()=>r("img",{src:$},null,-1)),qe={style:{width:"80%",margin:"10px auto"}},Ge=w(()=>r("img",{src:$},null,-1)),Je={style:{width:"80%",margin:"10px auto"}},Ke={key:0},Qe={style:{"margin-top":"10px"}},Xe=_e({__name:"[id]",setup(z){const{params:g}=fe(),R=xe(),N=ve(),f=p({_id:"",type:"",title:"",content:"",username:"",avatar:"",updatedAt:"",visitors:0,comments:0}),E=p(1),y=p(1),j=p(0),U=p(""),h=p(""),k=p(""),H=p(""),L=p(""),d=p({childComments:[],total:0,parent:{_id:"",content:"",createdAt:"",username:"",avatar:""}}),C=p([]),S=p(!1),B=p("50%");ge(async()=>{let n;if(n=await me(g.id),n){const l=await n.json();f.value=l.data}else console.log("Error fetching post");let e;if(e=await I(g.id,E.value),e){const l=await e.json();l.code===0?(C.value=l.data.comments,j.value=l.data.total):console.log("Error fetching comments")}else console.log("Error fetching comments")});const K=n=>{h.value="",H.value=n},Q=n=>{k.value="",L.value=n},F=async(n,e)=>{window.innerWidth<768?B.value="100%":B.value="50%";let l;if(y.value=1,l=await J(n,y.value),l){const o=await l.json();o.code===0?(d.value.childComments=o.data.comments,d.value.total=o.data.total,d.value.parent=o.data.parent):console.log("Error fetching child comments")}else console.log("Error fetching child comments");S.value=e},X=async(n,e,l)=>{let o;o=await ke(n,e,k.value,l),o&&(await o.json()).code===0&&(V.success("回复成功"),k.value="",y.value=Math.ceil(d.value.total/10),O(y.value))},Y=async n=>{E.value=n;let e;if(e=await I(g.id,E.value),e){const l=await e.json();l.code===0?(C.value=l.data.comments,j.value=l.data.total):console.log("Error fetching comments")}else console.log("Error fetching comments")},O=async n=>{y.value=n;let e;if(e=await J(d.value.parent._id,y.value),e){const l=await e.json();l.code===0?(d.value.childComments=l.data.comments,d.value.total=l.data.total):console.log("Error fetching child comments")}else console.log("Error fetching child comments")},Z=async()=>{let n;if(n=await G(),n){const e=await n.json();e.code===0?R.setUserInfo(e.data):N.push("/login")}else console.log("Error fetching user info");if(n=await Ee(g.id,U.value),n)if((await n.json()).code===0){V.success("评论成功"),U.value="";let l;if(l=await I(g.id,E.value),l){const o=await l.json();o.code===0?(C.value=o.data.comments,j.value=o.data.total):console.log("Error fetching comments")}else console.log("Error fetching comments")}else V.error("评论失败,请稍后再试");else console.log("Error posting comment")},W=async n=>{let e;if(e=await G(),e){const l=await e.json();l.code===0?R.setUserInfo(l.data):N.push("/login")}else console.log("Error fetching user info");if(e=await Ce(n,g.id,h.value),e)if((await e.json()).code===0){V.success("回复成功");let o;if(h.value="",o=await I(g.id,E.value),o){const v=await o.json();v.code===0?C.value=v.data.comments:console.log("Error fetching comments")}else console.log("Error fetching comments");F(n,!1)}else V.error("回复失败,请稍后再试");else console.log("Error posting comment")};return(n,e)=>{const l=se,o=le,v=oe,x=re,ee=ie,b=ce,A=de,q=ue,te=ne,ae=pe;return u(),_(M,null,[r("div",De,[r("div",{class:"backbtn",onClick:e[0]||(e[0]=a=>n.$router.back())},[(u(),_("svg",ze,be)),Ae])]),r("div",Me,[t(l,{size:50,src:f.value.avatar,style:{"vertical-align":"middle"}},{default:s(()=>[Te]),_:1},8,["src"]),r("span",Ie,c(f.value.username),1),r("div",$e,[r("h3",null,c(f.value.title),1),r("div",{innerHTML:f.value.content},null,8,Se)]),r("div",Be,[r("span",null,c(f.value.updatedAt.split("T")[0]),1)])]),r("div",Pe,[t(o,{class:"mx-1"},{default:s(()=>[i("浏览量: "+c(f.value.visitors),1)]),_:1}),t(o,{class:"mx-1",style:{"margin-left":"8px"}},{default:s(()=>[i("评论数: "+c(f.value.comments),1)]),_:1}),(u(!0),_(M,null,P(C.value,a=>(u(),_("div",{class:"comment",key:a._id},[t(l,{size:45,src:a.avatar,style:{"vertical-align":"middle"}},{default:s(()=>[Re]),_:2},1032,["src"]),r("span",Ne,c(a.username),1),r("div",He,[t(o,{class:"mx-1",size:"large"},{default:s(()=>[i(c(a.content),1)]),_:2},1024),t(v),a.total!==0?(u(),D(ee,{key:0},{default:s(()=>[(u(!0),_(M,null,P(a.childComments,m=>(u(),D(x,{style:{"margin-bottom":"8px"},key:m._id},{default:s(()=>[t(o,{class:"mx-1"},{default:s(()=>[i(c(m.username)+": "+c(m.content),1)]),_:2},1024)]),_:2},1024))),128)),a.total>2?(u(),D(x,{key:0},{default:s(()=>[t(o,{class:"mx-1 checkTotal",onClick:m=>F(a._id,!0)},{default:s(()=>[i("查看全部"+c(a.total)+"条评论",1)]),_:2},1032,["onClick"])]),_:2},1024)):T("",!0)]),_:2},1024)):T("",!0)]),r("div",Le,[t(o,{class:"mx-1",size:"small"},{default:s(()=>[i(c(a.createdAt.split("T")[0]),1)]),_:2},1024),t(o,{class:"mx-1 reply",style:{"margin-left":"10px"},onClick:m=>K(a._id)},{default:s(()=>[i("回复")]),_:2},1032,["onClick"])]),t(ye,{name:"el-fade-in-linear"},{default:s(()=>[H.value===a._id?(u(),_("div",Fe,[t(b,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=m=>h.value=m),modelModifiers:{trim:!0},placeholder:"请输入要回复的内容",type:"textarea",style:{width:"100%"},rows:2},null,8,["modelValue"]),t(A,{type:"primary",style:{width:"100%","margin-top":"10px"},onClick:m=>W(a._id)},{default:s(()=>[i("回复")]),_:2},1032,["onClick"])])):T("",!0)]),_:2},1024),t(v)]))),128)),t(q,{background:"",layout:"prev, pager, next",total:j.value,"page-size":10,"pager-count":5,style:{"justify-content":"center"},onCurrentChange:Y},null,8,["total"])]),r("div",Oe,[t(b,{modelValue:U.value,"onUpdate:modelValue":e[2]||(e[2]=a=>U.value=a),modelModifiers:{trim:!0},placeholder:"请输入评论内容",type:"textarea",style:{width:"100%"},rows:6},null,8,["modelValue"]),t(A,{type:"primary",size:"large",onClick:Z,style:{width:"100%","margin-top":"10px"}},{default:s(()=>[i("发送")]),_:1})]),t(ae,null,{default:s(()=>[t(te,{modelValue:S.value,"onUpdate:modelValue":e[6]||(e[6]=a=>S.value=a),size:B.value},{default:s(()=>[r("div",null,[t(l,{size:45,src:d.value.parent.avatar,style:{"vertical-align":"middle"}},{default:s(()=>[We]),_:1},8,["src"]),t(o,{class:"mx-1",style:{"margin-left":"8px"}},{default:s(()=>[i(c(d.value.parent.username),1)]),_:1}),r("div",qe,[t(x,null,{default:s(()=>[t(o,{class:"mx-1",size:"large"},{default:s(()=>[i(c(d.value.parent.content),1)]),_:1})]),_:1}),t(x,{style:{"margin-top":"10px","text-align":"right"}},{default:s(()=>[t(o,{class:"mx-1",size:"small",style:{"margin-top":"8px"}},{default:s(()=>[i(c(d.value.parent.createdAt.split("T")[0]),1)]),_:1})]),_:1})]),t(v,null,{default:s(()=>[i("以下是回复的评论")]),_:1})]),(u(!0),_(M,null,P(d.value.childComments,a=>(u(),_("div",{key:a._id,style:{"margin-top":"10px"}},[t(l,{size:45,src:a.avatar,style:{"vertical-align":"middle"}},{default:s(()=>[Ge]),_:2},1032,["src"]),t(o,{class:"mx-1",style:{"margin-left":"8px"}},{default:s(()=>[i(c(a.username)+": ",1)]),_:2},1024),r("div",Je,[t(x,null,{default:s(()=>[a.replyUsername?(u(),D(o,{key:0},{default:s(()=>[i("回复 "+c(a.replyUsername)+" : "+c(a.content),1)]),_:2},1024)):(u(),D(o,{key:1,class:"mx-1",size:"large"},{default:s(()=>[i(c(a.content),1)]),_:2},1024))]),_:2},1024),t(x,{style:{"margin-top":"10px","text-align":"right"}},{default:s(()=>[t(o,{class:"mx-1",size:"small"},{default:s(()=>[i(c(a.createdAt.split("T")[0]),1)]),_:2},1024),t(o,{class:"mx-1 reply",style:{"margin-left":"10px"},onClick:m=>Q(a._id)},{default:s(()=>[i("回复")]),_:2},1032,["onClick"])]),_:2},1024),L.value===a._id?(u(),_("div",Ke,[t(b,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=m=>k.value=m),modelModifiers:{trim:!0},placeholder:"请输入要回复的内容",type:"textarea",style:{width:"100%"},rows:2},null,8,["modelValue"]),t(A,{type:"primary",style:{width:"100%","margin-top":"10px"},onClick:m=>X(a.parentId,a.postId,a._id)},{default:s(()=>[i("回复")]),_:2},1032,["onClick"])])):T("",!0)]),t(v)]))),128)),t(q,{background:"",layout:"prev, pager, next",total:d.value.total,"page-size":10,"pager-count":5,style:{"justify-content":"center"},"current-page":y.value,onCurrentChange:O},null,8,["total","current-page"]),r("div",Qe,[t(b,{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=a=>h.value=a),modelModifiers:{trim:!0},placeholder:`回复 ${d.value.parent.username}`,type:"textarea",style:{width:"100%"},rows:2},null,8,["modelValue","placeholder"]),t(A,{type:"primary",style:{width:"100%","margin-top":"10px"},onClick:e[5]||(e[5]=a=>W(d.value.parent._id))},{default:s(()=>[i("回复")]),_:1})])]),_:1},8,["modelValue","size"])]),_:1})],64)}}}),gt=Ve(Xe,[["__scopeId","data-v-ea97d8f4"]]);export{gt as default};
